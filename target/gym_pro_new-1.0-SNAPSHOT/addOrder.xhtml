<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:pt="jakarta.faces.passthrough">

    <h:head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <title>Checkout &amp; Payment</title>

        <link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png"/>
        <link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"/>
        <link rel="stylesheet" href="assets/css/style.css"/>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'/>

        <style>
            /* Custom styling for visual separation and emphasis */
            .card-header-checkout {
                background-color: #f8f9fa; /* Light background for header */
                border-bottom: 1px solid #dee2e6;
                padding: 1rem 1.25rem;
                font-size: 1.25rem;
                font-weight: 600;
            }
            .form-group-total {
                border-top: 2px solid #e9ecef; /* Separator line for totals */
                margin-top: 20px;
                padding-top: 20px;
            }
            .total-price-value {
                font-size: 1.5rem;
                font-weight: 700;
                color: #28a745; /* Green color for emphasis */
            }
            /* --- UPDATED BUTTON STYLING --- */
            .btn-pay-custom {
                /* Primary Styling */
                background-color: #c82333; /* Your custom primary orange/red color */
                border: 2px solid #e06548; /* Slightly darker border for depth */
                color: white;
                font-size: 1.3rem; /* Slightly larger font */
                font-weight: 1000; /* Bold text */
                padding: 12px 40px; /* More padding */
                border-radius: 8px; /* Rounded corners */
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Soft shadow */
                transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            }
            .btn-pay-custom:hover {
                background-color: #c82333; /* Darker color on hover */
                border-color: #d15c40;
                color: white;
                transform: translateY(-1px); /* Subtle lift effect */
                box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2); /* Deeper shadow on hover */
            }
            /* Using Font Awesome for icons (improving UX) */
            .form-control-label .fa {
                margin-right: 8px;
            }
        </style>
    </h:head>

    <h:body>
        <div id="right-panel" class="right-panel">
            <div class="content">
                <div class="animated fadeIn">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <div class="card shadow">
                                <div class="card-header-checkout">
                                    <i class="fa fa-shopping-cart"></i> Order information
                                </div>
                                <div class="card-body">
                                    <h:form id="orderForm" class="form-horizontal">

                                        <h3 class="mb-4 text-primary"><i class="fa fa-map-marker"></i> Shipping Information</h3>

                                        <div class="row form-group">
                                            <div class="col col-md-3">
                                                <h:outputLabel for="userIdInput" value="User ID" class="form-control-label"/>
                                            </div>
                                            <div class="col-12 col-md-9">
                                                <h:inputText id="userIdInput" value="#{productCDIBean.userId}"
                                                             class="form-control" disabled="true" pt:placeholder="Your system User ID"/>
                                            </div>
                                        </div>

                                        <div class="row form-group">
                                            <div class="col col-md-3">
                                                <h:outputLabel for="shippingAddressInput" class="form-control-label">
                                                    <i class="fa fa-home"></i> Address
                                                </h:outputLabel>
                                            </div>
                                            <div class="col-12 col-md-9">
                                                <h:inputTextarea id="shippingAddressInput" value="#{productCDIBean.shippingAddress}"
                                                                 class="form-control" rows="3" required="true"
                                                                 pt:placeholder="Enter your complete shipping address"/>
                                            </div>
                                        </div>

                                        <div class="row form-group">
                                            <div class="col col-md-3">
                                                <h:outputLabel for="deliverAtInput" class="form-control-label">
                                                    <i class="fa fa-calendar"></i> Delivery At
                                                </h:outputLabel>
                                            </div>
                                            <div class="col-12 col-md-9">
                                                <h:inputText id="deliverAtInput" value="#{productCDIBean.deliverAt}"
                                                             class="form-control" pt:placeholder="e.g., Home/Office/Residency"/>
                                            </div>
                                        </div>

                                        <hr/>

                                        <h3 class="mb-4 text-primary"><i class="fa fa-credit-card-alt"></i> Payment Summary</h3>

                                        <div class="row form-group">
                                            <div class="col col-md-3">
                                                <h:outputLabel value="Item Subtotal" class="form-control-label"/>
                                            </div>
                                            <div class="col-12 col-md-9">
                                                <h:inputText value="#{productCDIBean.totalPrice}"
                                                             class="form-control text-right" disabled="true">
                                                    <f:convertNumber type="currency" currencySymbol="₹" minFractionDigits="0"/>
                                                </h:inputText>
                                            </div>
                                        </div>

                                        <div class="row form-group">
                                            <div class="col col-md-3">
                                                <h:outputLabel value="Shipping Price" class="form-control-label"/>
                                            </div>
                                            <div class="col-12 col-md-9 text-center">
                                                <h:inputText value="#{productCDIBean.shippingPrice}"
                                                             class="form-control text-right" disabled="true">
                                                    <f:convertNumber type="currency" currencySymbol="₹" minFractionDigits="0"/>
                                                </h:inputText>
                                            </div>
                                        </div>

                                        <div class="row form-group form-group-total">
                                            <div class="col col-md-3">
                                                <h:outputLabel value="Total Amount Due" class="form-control-label"/>
                                            </div>
                                            <div class="col-12 col-md-9 text-right">
                                                <span class="total-price-value text-center">
                                                    <h:outputText id="totalPriceOutput" value="#{productCDIBean.totalPrice + productCDIBean.shippingPrice}">
                                                        <f:convertNumber type="currency" currencySymbol="₹" minFractionDigits="0"/>
                                                    </h:outputText>
                                                </span>
                                            </div>
                                        </div>

                                        <div class="row form-group mt-5">
                                            <div class="col col-md-12 text-center">
                                                <h:commandButton value="Pay Now" type="button"
                                                                 class="btn btn-pay-custom btn-lg"
                                                                 onclick="openRazorpayPayment(); return false;" />

                                                <h:commandButton id="hiddenPayButton" value="hiddenPay"
                                                                 action="#{productCDIBean.addorder()}"
                                                                 style="display:none;" />
                                            </div>
                                        </div>
                                    </h:form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script>
        <script src="assets/js/main.js"></script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <script type="text/javascript">
                                                                     function openRazorpayPayment() {
                                                                         // Access total amount using the JSF EL expression
                                                                         var totalAmount = "#{productCDIBean.totalPrice + productCDIBean.shippingPrice}";
                                                                         // Ensure correct calculation for Razorpay, which expects amount in paise (cents) as an integer
                                                                         var amountInPaise = Math.round(parseFloat(totalAmount) * 100);

                                                                         var options = {
                                                                             "key": "rzp_test_VWZZ4Jn0Rd1lpQ", // Your Razorpay key
                                                                             "amount": amountInPaise,
                                                                             "currency": "INR",
                                                                             "name": "Your Company",
                                                                             "description": "Order Payment",
                                                                             "image": "path/to/logo.png",
                                                                             "handler": function (response) {
                                                                                 // Trigger the hidden button to process payment in JSF
                                                                                 // NOTE: In a secure implementation, you should pass paymentId/signature to the server for verification.
                                                                                 document.getElementById("orderForm:hiddenPayButton").click();
                                                                             },
                                                                             "prefill": {
                                                                                 "name": "#{loginBean.u.name}",
                                                                                 "email": "#{loginBean.u.email}",
                                                                                 "contact": "#{loginBean.u.contact}"
                                                                             },
                                                                             "theme": {
                                                                                 "color": "#F37254"
                                                                             }
                                                                         };

                                                                         var rzp1 = new Razorpay(options);
                                                                         rzp1.open();
                                                                     }
        </script>
    </h:body>
</html>